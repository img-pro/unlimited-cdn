# Bandwidth Saver Worker - Self-Hosted Configuration
#
# This worker caches WordPress images in Cloudflare R2 and serves them globally.
# No external dependencies - just R2 storage and your Cloudflare account.
#
# SETUP:
#   1. Copy this file: cp wrangler.toml.example wrangler.toml
#   2. Edit the values below (marked with YOUR_)
#   3. Create R2 bucket: wrangler r2 bucket create bandwidth-saver-cache
#   4. Deploy: npm run deploy
#   5. Add custom domain in Cloudflare dashboard (see README)

name = "bandwidth-saver"
main = "src/index.ts"
compatibility_date = "2025-01-15"
compatibility_flags = ["nodejs_compat"]

# Your Cloudflare account ID (find in dashboard URL or run: wrangler whoami)
account_id = "YOUR_ACCOUNT_ID"

# Route: Which domain serves your CDN
# Replace with your domain. The zone_name must be a domain in your Cloudflare account.
routes = [
  { pattern = "cdn.YOUR_DOMAIN.com/*", zone_name = "YOUR_DOMAIN.com" }
]

# R2 bucket for image caching (private - worker handles all access)
[[r2_buckets]]
binding = "R2"
bucket_name = "bandwidth-saver-cache"

# Configuration
[vars]
# ORIGIN_MODE: Which WordPress sites can use this CDN
#
#   "list" (recommended) - Only allow domains you specify in ALLOWED_ORIGINS
#                          Prevents unauthorized use of your CDN
#
#   "open"               - Allow any domain (use only for testing)
#
ORIGIN_MODE = "list"

# ALLOWED_ORIGINS: Comma-separated list of domains that can use this CDN
# Only used when ORIGIN_MODE = "list"
#
# Examples:
#   Single site:    "example.com"
#   With www:       "example.com,www.example.com"
#   With subdomain: "example.com,www.example.com,blog.example.com"
#   Wildcard:       "*.example.com" (all subdomains, but NOT example.com itself)
#
ALLOWED_ORIGINS = "YOUR_WORDPRESS_DOMAIN.com,www.YOUR_WORDPRESS_DOMAIN.com"

# BLOCKED_ORIGINS: Domains to always reject (optional, leave empty)
# Use "*" as emergency kill switch to block all traffic
BLOCKED_ORIGINS = ""

# Maximum image file size to cache
# Larger files redirect to origin (user downloads directly from WordPress)
MAX_FILE_SIZE = "50MB"

# Origin fetch timeout in milliseconds
# How long to wait for WordPress to respond
FETCH_TIMEOUT = "30000"

# Debug mode - enables ?view=1 parameter for troubleshooting
# Set to "false" in production (prevents information disclosure)
DEBUG = "false"
